
<script>
var show_user_id = <%= user.id %>
var session_user = 0;
var done_status = ''
</script>

<%- partial ('js_templates.html.ejs') %>

<div id="nav-wrapper">
  <% if (session.authenticated) { %>
  <%- partial ('../navbar_loggedin.ejs') %>
  <% } else { %>
  <%- partial ('../navbar_loggedout.ejs') %>
  <% } %>
</div>


<div class="container">
  <div id="dashboard-container">
  </div>
</div>

<div id="inspiration-todo-list">
  <div class="col-lg-6">
    <h3>Looking forward to doing ...</h3>
    <div id="notdone">
      <% for (var i in todoInspirations) { %>
      <div class="inspiration-item">
        <div class="inspiration-text">
          <%= todoInspirations[i].text %>
        </div>
        <div class="inspiration-user">
          <%= todoInspirations[i].user_id %>
        </div>
      </div>
      <% } %>
    </div>
  </div>
  <div class="col-lg-6">
    <h3>I've inspired others by...</h3>
    <div id="done">
      <% for (var i in doneInspirations) { %>
      <div class="inspiration-item">
        <div class="inspiration-text">
          <%= todoInspirations[i].text %>
        </div>
        <div class="inspiration-user">
          <%= todoInspirations[i].user_id %>
        </div>
      </div>
      <% } %>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
  $("#add-inspiration").appendTo("#dashboard-container");
});
</script>


<% if (!(session.authenticated)) { %>
  <% return false; } else { %>
<% if (session.User.id == user.id) { %>
  <script>
  session_user = <%= session.User.id %>
  </script>

  <div id="add-inspiration">
    <form method="post" action="/inspiration/create">
      <!-- Posts csrf token, user_id + original_creator_id, done_status and text to /inspiration/create -->
      <input type='hidden' name='_csrf' value='<%= _csrf %>'>
      <input type='hidden' name="user_id" value='<%= user.id %>'>
      <input type='hidden' name="original_creator_id" value='<%= user.id %>'>
      <input type='hidden' value='0' name='done'>
      <input type="text" name="text" id="new-inspiration" placeholder="Enter something inspiring!"> <br />
      <div>
        <span class="input_done">
          <input type="checkbox">I've done this!
        </span>
      </div>
      <input type="submit" value="Add Inspiration" id="submit" class="btn btn-info btn-lg">

      <script>
        $('#add-inspiration form').on("submit", function(e) {
          e.preventDefault();

          var done_status = $('input[type="checkbox"]').prop('checked');
          if (done_status) {
            done_status = 1;
          }
          else {
            done_status = 0;
          };

          $.ajax({
            url: '/inspiration/create',
            type: 'POST',
            data: {
              user_id: session_user,
              original_creator_id: session_user,
              text: $('#new-inspiration').val(),
              done: done_status,
              _csrf: '<%= _csrf %>'
            }
          })
          .success(function(data) {
            obj = {
              inspiration: data,
            };
            if (data.done) {
              $('#inspiration-todo-list div#done').prepend(
                JST['assets/linker/templates/addInspiration.ejs'](obj)
              ).masonry('reloadItems');
              // $('#inspiration-todo-list div#done').masonry( 'prepended', '<div class="inspiration-item"><div class="inspiration-text">' + data.text + '</div><div class="inspiration-user">' + data.user_id + '</div>' );
            }
            else {
              $('#inspiration-todo-list div#notdone').prepend(
                JST['assets/linker/templates/addInspiration.ejs'](obj)
              ).masonry('reloadItems');
              // $('#inspiration-todo-list div#done').masonry( 'prepended', '<div class="inspiration-item"><div class="inspiration-text">' + data.text + '</div><div class="inspiration-user">' + data.user_id + '</div>');
            }
          });
        });
      </script>
    </form>
  </div>
<% } } %>


